---
import Layout from '../layouts/Layout.astro';
import cvData from '../data/cv.json';
import profilePhoto from '../assets/profile-photo.jpg';

const { profile, skills, toolkit, history, education, certifications } = cvData;


// Normalize company names for i18n keys
const getJobKey = (company: string) => {
  const c = company.toLowerCase();
  if (c.includes('zenvia')) return 'zenvia';
  if (c.includes('hubify')) return 'hubify';
  if (c.includes('rethink')) return 'rethink';
  if (c.includes('blip')) return 'blip';
  if (c.includes('gauge')) return 'gauge';
  if (c.includes('weber')) return 'weber';
  if (c.includes('brasa')) return 'brasa';
  if (c.includes('pólis')) return 'polis';
  return '';
};

const getCertKey = (name: string) => {
  const n = name.toLowerCase();
  if (n.includes('english')) return 'cert.english';
  if (n.includes('artificial intelligence')) return 'cert.ai';
  if (n.includes('digital product leadership')) return 'cert.leadership';
  if (n.includes('google analytics')) return 'cert.ga';
  if (n.includes('leadership and business strategy')) return 'cert.strategy';
  if (n.includes('agile project manager')) return 'cert.agile';
  return '';
};

// Group skills by category for visual display
const skillCategories = [
  { name: 'Gestão de Produto', skills: ['Product Vision', 'Product Strategy', 'Roadmapping', 'Backlog Prioritization', 'Discovery & Delivery'] },
  { name: 'Eficiência & Operações', skills: ['Process Automation', 'Cost Reduction', 'Journey Optimization'] },
  { name: 'Tecnologia & Dados', skills: ['API Integration', 'ERPs (SAP)', 'CRMs (Salesforce/HubSpot)', 'Data Analytics', 'AI & Chatbots'] },
  { name: 'Metodologias', skills: ['Agile', 'Scrum', 'Kanban', 'Lean'] },
  { name: 'Negócios', skills: ['Stakeholder Management', 'KPIs & OKRs', 'Strategic Planning'] },
];
---

<Layout title={`CV | ${profile.name}`}>
  <article class="py-12 print:py-0 print:max-w-none">
    
    {/* Header */}
    <div class="bg-surface-subtle py-16 mb-12 print:bg-white print:py-6">
      <div class="section-container">
        <header class="flex flex-col md:flex-row items-center md:items-start gap-8">
          
          {/* Profile Photo */}
          <div class="flex-shrink-0">
            <img 
              src={profilePhoto.src} 
              alt={profile.name}
              class="profile-photo print:w-24 print:h-24"
            />
          </div>
          
          {/* Name & Contact */}
          <div class="flex-grow text-center md:text-left">
            <h1 class="text-4xl md:text-5xl font-display text-text mb-3 print:text-3xl">
              {profile.name}
            </h1>
            <h2 class="text-xl font-semibold text-accent mb-5 print:text-lg">
              <span data-i18n="home.role">{profile.role}</span>
            </h2>
            
            {/* Contact Info Row */}
            <div class="flex flex-wrap justify-center md:justify-start gap-4 text-sm text-text-muted">
              <a href={`mailto:${profile.email}`} class="link-hover flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                {profile.email}
              </a>
              <a href={`tel:${profile.phone.replace(/\s/g, '')}`} class="link-hover flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                {profile.phone}
              </a>
              <a href={`https://${profile.linkedin}`} target="_blank" class="link-hover flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></svg>
                LinkedIn
              </a>
              <span class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                <span data-i18n="home.location">{profile.location}</span>
              </span>
            </div>
          </div>
        </header>
      </div>
    </div>

    <div class="section-container">
      {/* Summary */}
      <section class="mb-12 pb-10 border-b border-border print:mb-6 print:pb-4">
        <div class="flex items-center gap-3 mb-5">
          <span class="section-line"></span>
          <h3 class="text-sm font-bold uppercase tracking-widest text-text-muted" data-i18n="cv.about">About</h3>
        </div>
        <p class="text-text-secondary leading-relaxed max-w-4xl print:text-sm">
          <span data-i18n="cv.summary">{profile.summary}</span>
        </p>
      </section>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 print:gap-8">
        
        {/* Main Column: Work History */}
        <div class="lg:col-span-2 space-y-10">
          <section>
            <div class="flex items-center gap-3 mb-8">
              <span class="section-line"></span>
              <h3 class="text-sm font-bold uppercase tracking-widest text-text-muted" data-i18n="cv.experience">Professional Experience</h3>
            </div>
            
            <div class="space-y-10 print:space-y-6">
              {history.map((job) => {
                const jobKey = getJobKey(job.company);
                return (
                  <div class="relative pl-6 border-l-2 border-border hover:border-accent transition-colors">
                    <div class="absolute -left-[7px] top-1 w-3 h-3 rounded-full bg-accent ring-2 ring-surface"></div>
                    
                    {/* Company & Period */}
                    <div class="flex flex-col md:flex-row md:justify-between md:items-baseline mb-2 gap-1">
                      <h4 class="text-lg font-bold text-text print:text-base">{job.company}</h4>
                      <span class="text-xs font-mono text-accent font-semibold px-2 py-0.5 bg-accent/10 rounded-full">
                        {job.period.includes('Presente') || job.period.includes('Present') ? (
                          <>
                            {job.period.split(' – ')[0]} – <span data-i18n="common.present">{job.period.split(' – ')[1]}</span>
                          </>
                        ) : job.period}
                      </span>
                    </div>
                    
                    {/* Role */}
                    <div class="text-sm font-semibold text-accent mb-2 print:text-xs print:mb-1">
                      <span data-i18n={jobKey ? `job.${jobKey}.role` : undefined}>{job.role}</span>
                    </div>
                    
                    {/* Company Headline */}
                    {job.headline && (
                      <p class="text-xs text-text-muted italic mb-4 pl-2 border-l-2 border-accent/30">
                        {job.headline}
                      </p>
                    )}
                    
                    {/* Description - First item highlighted */}
                    <ul class="space-y-3 text-sm text-text-secondary leading-relaxed print:text-xs">
                      {job.description.map((desc, idx) => (
                        <li class={`flex items-start gap-2 ${idx === 0 ? 'bg-surface-elevated p-3 rounded-lg border border-border/50' : ''}`}>
                          <span class={`mt-1 text-xs ${idx === 0 ? 'text-accent' : 'text-accent/60'}`}>▸</span>
                          <span class={idx === 0 ? 'text-text font-medium' : ''} data-i18n={jobKey ? `job.${jobKey}.desc.${idx}` : undefined}>{desc}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                );
              })}
            </div>
          </section>
        </div>

        {/* Sidebar */}
        <aside class="space-y-10 print:text-xs">
          
          {/* Skills - Grouped by Category */}
          <section>
            <div class="flex items-center gap-3 mb-5">
              <span class="section-line"></span>
              <h3 class="text-sm font-bold uppercase tracking-widest text-text-muted" data-i18n="cv.skills">Key Competencies</h3>
            </div>
            <div class="space-y-4">
              {skillCategories.map(category => (
                <div>
                  <h4 class="text-xs font-semibold text-accent/80 uppercase tracking-wider mb-2">{category.name}</h4>
                  <div class="flex flex-wrap gap-1.5">
                    {category.skills.map(skill => (
                      <span class="badge text-xs print:border print:border-border print:bg-white" data-i18n={`skill.${skill}`}>
                        {skill}
                      </span>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Toolkit */}
          <section>
            <div class="flex items-center gap-3 mb-5">
              <span class="section-line"></span>
              <h3 class="text-sm font-bold uppercase tracking-widest text-text-muted" data-i18n="cv.tools">Tools</h3>
            </div>
            <div class="text-sm text-text-secondary leading-relaxed flex flex-wrap gap-x-2 gap-y-1">
              {toolkit.map((tool, index) => (
                <>
                  <span data-i18n={`tool.${tool}`}>{tool}</span>
                  {index < toolkit.length - 1 && <span class="text-accent">•</span>}
                </>
              ))}
            </div>
          </section>

          {/* Education */}
          <section>
            <div class="flex items-center gap-3 mb-5">
              <span class="section-line"></span>
              <h3 class="text-sm font-bold uppercase tracking-widest text-text-muted" data-i18n="cv.education">Education</h3>
            </div>
            {education.map(edu => (
              <div class="mb-4">
                <div class="font-bold text-text text-sm">{edu.institution}</div>
                <div class="text-sm text-text-secondary mt-1">
                  <span data-i18n={edu.institution.includes('USP') ? 'edu.usp.degree' : undefined}>{edu.degree}</span>
                </div>
                {edu.details && (
                  <div class="text-xs text-text-muted mt-1 italic">
                    <span data-i18n={edu.institution.includes('USP') ? 'edu.usp.details' : undefined}>{edu.details}</span>
                  </div>
                )}
                <div class="text-xs font-mono text-accent mt-1">{edu.year}</div>
              </div>
            ))}
          </section>

          {/* Certifications */}
          <section class="bg-surface-elevated p-5 rounded-2xl border border-border print:bg-white print:border print:border-border">
            <div class="flex items-center gap-3 mb-5">
              <span class="section-line"></span>
              <h3 class="text-sm font-bold uppercase tracking-widest text-text-muted" data-i18n="cv.certifications">Certifications</h3>
            </div>
            <ul class="space-y-3">
              {certifications.map(cert => {
                const certKey = getCertKey(cert.name);
                return (
                  <li class="flex flex-col">
                    <span class="text-sm font-medium text-text" data-i18n={certKey || undefined}>{cert.name}</span>
                    <span class="text-xs text-text-muted">{cert.issuer}</span>
                  </li>
                );
              })}
            </ul>
          </section>

        </aside>
      </div>

      <div class="mt-20 pt-10 border-t border-border text-center print:hidden">
        <button id="btn-print-cv" onclick="window.print()" class="btn-outline cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 14h12v8H6z"/></svg>
          <span data-i18n="cv.download">Download PDF / Print</span>
        </button>
      </div>
    </div>

  </article>
</Layout>

<style>
  @media print {
    :global(header), :global(footer) {
      display: none !important;
    }
    :global(body) {
      background: white !important;
      padding: 0 !important;
      color: black !important;
    }
    :global(main) {
      padding-top: 0 !important;
    }
  }
</style>
